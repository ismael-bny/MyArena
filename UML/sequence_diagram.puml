@startuml

actor User as UI

participant "LoginFrame\n(ui)" as LoginFrame
participant "LoginController\n(ui)" as LoginController
participant "SessionFacade\n(faÃ§ade)" as SessionFacade
participant "UserManager\n(services)" as UserManager
participant "AbstractFactory\n(persistance.factory)" as AbsFactory
participant "PostgresFactory\n(persistance.factory)" as PGFactory
participant "UserDAOPostgres\n(persistance.dao)" as UserDAOPG
database "Postgres DB" as DB
participant "User\n(domain)" as UserObj

== User Initiates Login ==
UI -> LoginFrame: enterCredentials()
LoginFrame -> LoginController: login()

== Controller delegates to the Facade ==
LoginController -> SessionFacade: login(id, pwd)

== Facade delegates to UserManager ==
SessionFacade -> UserManager: login(id, pwd)

== UserManager obtains DAO through Abstract Factory ==
UserManager -> AbsFactory: createUserDAO()
AbsFactory -> PGFactory: new PostgresFactory()
activate PGFactory
PGFactory -> UserDAOPG: new UserDAOPostgres()
activate UserDAOPG
PGFactory --> UserManager: UserDAOPostgres
deactivate PGFactory

== DAO Queries Database ==
UserManager -> UserDAOPG: getUserByCredentials(id, pwd)
UserDAOPG -> DB: SELECT * FROM users WHERE...
DB --> UserDAOPG: user data

== DAO Builds a Domain User ==
UserDAOPG -> UserObj: new User(id, name, email, pwdHash, phone, role, status)
activate UserObj
UserDAOPG --> UserManager: boolean
deactivate UserDAOPG

== UserManager returns User ==
UserManager --> SessionFacade: boolean
SessionFacade -> SessionFacade: currentUser = User
deactivate UserObj

SessionFacade --> LoginController: true
LoginController --> LoginFrame: updateUI(success)

UI <-- LoginFrame: show home screen

@enduml
